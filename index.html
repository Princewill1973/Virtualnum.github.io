<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Virtual Indian Number Generator</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 0; }
        .container { max-width: 640px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 32px; }
        h1 { text-align: center; color: #2d5c7f; }
        .btn { background: #2d5c7f; color: #fff; padding: 12px 24px; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; }
        .btn:disabled { background: #aaa; }
        .virtual-number { font-weight: bold; font-size: 20px; color: #13436c; }
        .number-block { margin: 24px 0; padding: 16px; background: #eef3f7; border-radius: 6px; }
        .sms-section, .call-section { margin-top: 10px; }
        ul { padding-left: 18px; }
        .error { color: #b20000; margin: 8px 0 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Virtual Indian Number Generator</h1>
        <button class="btn" id="generateBtn">Create Virtual Number</button>
        <div id="error" class="error"></div>
        <div id="numberList"></div>
    </div>

    <script>
        async function fetchNumbers() {
            const container = document.getElementById('numberList');
            container.innerHTML = "<p>Loading numbers...</p>";
            const res = await fetch('/api/numbers');
            const numbers = await res.json();
            if (!numbers.length) {
                container.innerHTML = "<p>No virtual numbers created yet.</p>";
                return;
            }
            container.innerHTML = "";
            numbers.forEach(num => {
                const div = document.createElement('div');
                div.className = "number-block";
                div.innerHTML = `
                    <div class="virtual-number">${num.number}</div>
                    <button class="btn" onclick="viewDetails('${num.sid}', this)">Show SMS & Calls</button>
                    <div id="details-${num.sid}"></div>
                `;
                container.appendChild(div);
            });
        }

        async function viewDetails(sid, btn) {
            btn.disabled = true;
            btn.innerText = "Loading...";
            const res = await fetch(`/api/numbers/${sid}`);
            const data = await res.json();
            const detailsDiv = document.getElementById(`details-${sid}`);
            detailsDiv.innerHTML = `
                <div class="sms-section">
                    <h4>SMS Received</h4>
                    <ul>
                        ${(data.sms && data.sms.length) ? data.sms.map(s => `<li><b>${s.from}:</b> ${s.body}</li>`).join('') : '<li>No SMS received yet.</li>'}
                    </ul>
                </div>
                <div class="call-section">
                    <h4>Calls Received</h4>
                    <ul>
                        ${(data.calls && data.calls.length) ? data.calls.map(c => `<li>From: ${c.from} | Status: ${c.status}</li>`).join('') : '<li>No calls received yet.</li>'}
                    </ul>
                </div>
            `;
            btn.disabled = false;
            btn.innerText = "Show SMS & Calls";
        }

        document.getElementById('generateBtn').onclick = async () => {
            document.getElementById('error').innerText = "";
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').innerText = "Generating...";
            const res = await fetch('/api/generate', { method: 'POST' });
            if (res.ok) {
                await fetchNumbers();
            } else {
                const err = await res.json();
                document.getElementById('error').innerText = err.error || "An error occurred.";
            }
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerText = "Create Virtual Number";
        };

        // Load numbers on page load
        fetchNumbers();
    </script>
</body>
</html>
